document.addEventListener("DOMContentLoaded", function () {
  const waitForElement = (selector, callback, timeout = 5000) => {
    const intervalTime = 100;
    let timePassed = 0;
    const interval = setInterval(() => {
      const el = document.querySelector(selector);
      if (el) {
        clearInterval(interval);
        callback(el);
      }
      timePassed += intervalTime;
      if (timePassed >= timeout) clearInterval(interval);
    }, intervalTime);
  };

  waitForElement('a[title="menu-oferta"]', function (menuBtn) {
    const menuItem = menuBtn.parentElement;
    const modal = document.querySelector('.oferta-nivel-dois');

    if (!modal) return;

    // Remove o hover
    menuItem.classList.add("bloquear-hover-oferta");
    modal.classList.remove("ativo");
    modal.style.display = "none";

    // Clique para mostrar/ocultar
    menuBtn.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();

      const isActive = modal.classList.contains("ativo");

      if (isActive) {
        modal.classList.remove("ativo");
        modal.style.display = "none";
      } else {
        modal.classList.add("ativo");
        modal.style.display = "block";
      }
    });

    // Fecha ao clicar fora
    document.addEventListener("click", function (e) {
      if (!menuItem.contains(e.target) && !modal.contains(e.target)) {
        modal.classList.remove("ativo");
        modal.style.display = "none";
      }
    });
  });
});
