<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - WidgetVPN</title>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gray-900: #0f172a;
            --gray-800: #1e293b;
            --gray-700: #334155;
            --gray-600: #475569;
            --gray-500: #64748b;
            --gray-400: #94a3b8;
            --gray-300: #cbd5e1;
            --gray-200: #e2e8f0;
            --gray-100: #f1f5f9;
            --gray-50: #f8fafc;

            --blue-600: #2563eb;
            --blue-500: #3b82f6;
            --blue-400: #60a5fa;

            --green-500: #10b981;
            --red-500: #ef4444;

            --border-radius: 8px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll on body */
        }

        .dashboard {
            display: flex;
            height: 100vh;
            overflow: hidden; /* Prevent any overflow from dashboard container */
            width: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            overflow-x: hidden; /* No horizontal scroll */
            overflow-y: auto; /* Allow vertical scroll if needed */
            flex-shrink: 0; /* Prevents sidebar from shrinking */
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .logo-subtitle {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .nav {
            flex: 1;
            padding: 16px 0;
            overflow-x: hidden; /* Prevent horizontal scroll only */
            overflow-y: auto; /* Allow vertical scroll if needed */
        }

        /* Nav separator */
        .nav-separator {
            height: 1px;
            background: var(--gray-200);
            margin: 20px 16px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--gray-600);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 8px;
            border-radius: 8px;
        }

        .nav-item:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .nav-item.active {
            background: var(--blue-500);
            color: white;
        }

        .nav-item.active:hover {
            background: var(--blue-600);
        }

        .nav-icon {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            opacity: 0.8;
        }

        /* Project Groups */
        .nav-group {
            margin-bottom: 8px;
        }

        .project-header {
            position: relative;
            justify-content: space-between;
            font-weight: 600;
        }

        .project-header .chevron {
            margin-left: auto;
            transition: transform 0.2s ease;
            opacity: 0.6;
            width: 14px;
            height: 14px;
        }

        .nav-group.expanded .chevron {
            transform: rotate(90deg);
        }

        .nav-group.expanded .project-header {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        /* Status Indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
            margin-right: 4px;
        }

        .status-indicator.active {
            background: var(--green-500);
            box-shadow: 0 0 4px var(--green-500);
        }

        .status-indicator.dev {
            background: var(--blue-400);
            box-shadow: 0 0 4px var(--blue-400);
        }

        /* Submenus */
        .nav-submenu {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.2s ease;
            background: var(--gray-50);
            margin: 4px 8px 0;
            border-radius: 8px;
            border-left: 3px solid var(--blue-500);
            max-height: 0;
            opacity: 0;
        }

        .nav-group.expanded .nav-submenu {
            max-height: calc(3 * 45px + 8px); /* Exactly 3 items + padding */
            opacity: 1;
        }

        .nav-submenu .nav-item {
            font-size: 13px;
            padding: 10px 16px 10px 40px;
            margin: 0;
            border-radius: 0;
            color: var(--gray-600);
            font-weight: 400;
            white-space: nowrap; /* Prevent text wrapping */
            overflow: hidden; /* Hide overflow text */
            text-overflow: ellipsis; /* Show ellipsis for long text */
        }

        .nav-submenu .nav-item:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .nav-submenu .nav-item.active {
            background: var(--blue-500);
            color: white;
            border-left: 3px solid var(--blue-400);
            margin-left: -3px;
        }

        .nav-submenu .nav-item:first-child {
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            margin-top: 4px;
        }

        .nav-submenu .nav-item:last-child {
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            margin-bottom: 4px;
        }

        /* Coming Soon & Disabled States */
        .coming-soon {
            opacity: 0.7;
        }

        .coming-soon .status-indicator.dev {
            opacity: 0.6;
        }

        .disabled {
            opacity: 0.5;
            cursor: not-allowed !important;
        }

        .disabled:hover {
            background: transparent !important;
            color: var(--gray-400) !important;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Prevents flex overflow */
            overflow: hidden; /* Prevents content from leaking */
        }

        .main-header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 0 32px;
            height: 72px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .main-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
        }


        .main-body {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            overflow-x: hidden; /* Prevents horizontal overflow */
            max-width: 100%; /* Ensures content doesn't exceed container */
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
            max-width: 100%; /* Prevents grid overflow */
            overflow: hidden; /* Prevents card overflow */
        }

        .card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            max-width: 100%; /* Prevent card overflow */
            overflow: hidden; /* Hide any overflowing content */
            box-sizing: border-box; /* Include padding in width calculation */
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .metric {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .metric-label {
            font-size: 14px;
            color: var(--gray-500);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--blue-500);
            color: white;
        }

        .btn-primary:hover {
            background: var(--blue-600);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            background: white;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .btn-icon:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
            color: var(--gray-800);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--gray-500);
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-300);
            border-top: 2px solid var(--blue-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .dashboard {
                overflow-x: hidden; /* Force no horizontal scroll on mobile */
                position: relative;
            }

            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: var(--shadow-lg);
                overflow-x: hidden; /* No horizontal scroll in mobile sidebar */
                overflow-y: auto; /* Allow vertical scroll */
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                width: 100%; /* Full width on mobile */
                min-height: 100vh;
            }

            .main-header {
                padding: 0 16px; /* Reduced padding on mobile */
                height: 60px; /* Slightly shorter on mobile */
                position: relative;
                z-index: 10;
            }

            .main-title {
                font-size: 20px; /* Reasonable size on mobile */
            }

            .main-body {
                padding: 16px; /* Reduced padding on mobile */
                overflow-x: hidden; /* Force no horizontal overflow on mobile */
            }

            .card-grid {
                grid-template-columns: 1fr; /* Single column on mobile */
                gap: 16px; /* Reduced gap */
            }

            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                z-index: 900;
                display: none;
            }

            .mobile-overlay.active {
                display: block;
            }

            .mobile-menu-btn {
                display: flex !important;
                align-items: center;
                justify-content: center;
                background: none;
                border: none;
                color: var(--gray-600);
                font-size: 24px;
                cursor: pointer;
                padding: 8px;
                border-radius: 4px;
            }

            .mobile-menu-btn:hover {
                background: var(--gray-100);
            }
        }

        .mobile-menu-btn {
            display: none;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">WidgetVPN</div>
                <div class="logo-subtitle">Admin Dashboard</div>
            </div>

            <nav class="nav">
                <!-- Dashboard -->
                <div class="nav-item active" data-page="dashboard">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
                        <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
                    </svg>
                    Dashboard
                </div>

                <!-- Script Deploy -->
                <div class="nav-group" data-project="script-deploy">
                    <div class="nav-item project-header" onclick="toggleProject('script-deploy')">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Script Deploy
                        <span class="status-indicator active"></span>
                        <svg class="chevron" width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="nav-submenu" id="script-deploy-submenu">
                        <div class="nav-item" data-page="script-codes">
                            <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                            </svg>
                            Códigos
                        </div>
                        <div class="nav-item" data-page="script-deploy">
                            <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                            </svg>
                            Deploy & Status
                        </div>
                        <div class="nav-item" data-page="script-settings">
                            <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                            </svg>
                            Configurações
                        </div>
                    </div>
                </div>

                <!-- App Manager -->
                <div class="nav-item coming-soon">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                    </svg>
                    App Manager
                    <span class="status-indicator dev"></span>
                </div>

                <!-- URL Shortener -->
                <div class="nav-item coming-soon">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/>
                    </svg>
                    URL Shortener
                    <span class="status-indicator dev"></span>
                </div>

                <!-- Analytics Hub -->
                <div class="nav-item coming-soon">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                    </svg>
                    Analytics Hub
                    <span class="status-indicator dev"></span>
                </div>

                <!-- Separator -->
                <div class="nav-separator"></div>

                <!-- Settings -->
                <div class="nav-item" data-page="system-settings">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                    Settings
                </div>

                <!-- Logs -->
                <div class="nav-item" data-page="system-logs">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                    </svg>
                    Logs
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
                <h1 class="main-title" id="pageTitle">Dashboard</h1>
            </header>

            <div class="main-body" id="mainContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Carregando...</div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <script>
        // Simple SPA Router
        class Dashboard {
            constructor() {
                this.currentPage = 'dashboard';
                this.init();
            }

            init() {
                this.bindEvents();
                this.showPage('dashboard');
            }

            bindEvents() {
                // Navigation
                document.addEventListener('click', (e) => {
                    const navItem = e.target.closest('[data-page]');
                    if (navItem && !navItem.classList.contains('disabled')) {
                        e.preventDefault();
                        const page = navItem.getAttribute('data-page');
                        this.showPage(page);

                        // Close mobile menu on navigation
                        if (window.innerWidth <= 768) {
                            const sidebar = document.getElementById('sidebar');
                            const overlay = document.getElementById('mobileOverlay');
                            if (sidebar) sidebar.classList.remove('active');
                            if (overlay) overlay.classList.remove('active');
                        }
                    }
                });

                // Mobile menu
                const mobileBtn = document.getElementById('mobileMenuBtn');
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');

                if (mobileBtn) {
                    mobileBtn.addEventListener('click', () => {
                        sidebar.classList.toggle('active');
                        overlay.classList.toggle('active');
                    });
                }

                if (overlay) {
                    overlay.addEventListener('click', () => {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                    });
                }
            }

            // Project toggle functionality
            toggleProject(projectId, forceOpen = false) {
                const projectGroup = document.querySelector(`[data-project="${projectId}"]`);

                if (!projectGroup) return;

                const isExpanded = projectGroup.classList.contains('expanded');

                // If forcing open (from navigation), just expand this project
                if (forceOpen) {
                    // Close all other projects first
                    document.querySelectorAll('.nav-group').forEach(group => {
                        group.classList.remove('expanded');
                    });

                    // Open this project
                    projectGroup.classList.add('expanded');
                    return;
                }

                // Normal toggle behavior
                if (isExpanded) {
                    // Close this project
                    projectGroup.classList.remove('expanded');
                } else {
                    // Close all other projects first
                    document.querySelectorAll('.nav-group').forEach(group => {
                        group.classList.remove('expanded');
                    });

                    // Open this project
                    projectGroup.classList.add('expanded');
                }
            }

            showPage(page) {
                // Update navigation - remove all active states
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });

                // Auto-expand and highlight project if accessing submenu
                if (page.includes('script-')) {
                    this.toggleProject('script-deploy', true);

                    // Keep project header highlighted when in submenu
                    const projectHeader = document.querySelector('[data-project="script-deploy"] .project-header');
                    if (projectHeader) {
                        projectHeader.classList.add('active');
                    }
                }

                // Set active state on current page
                const activeItem = document.querySelector(`[data-page="${page}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                }

                // Update title
                const titles = {
                    'dashboard': 'Dashboard Multi-Projetos',
                    'script-codes': 'Script Deploy - Códigos',
                    'script-deploy': 'Script Deploy - Deploy & Status',
                    'script-settings': 'Script Deploy - Configurações',
                    'system-settings': 'Sistema - Configurações',
                    'system-logs': 'Sistema - Logs'
                };

                document.getElementById('pageTitle').textContent = titles[page] || 'Dashboard';

                // Load content
                this.loadContent(page);
            }

            loadContent(page) {
                const content = document.getElementById('mainContent');

                const pages = {
                    'dashboard': this.getDashboardContent(),
                    'script-codes': this.getScriptCodesContent(),
                    'script-deploy': this.getScriptDeployContent(),
                    'script-settings': this.getScriptSettingsContent(),
                    'system-settings': this.getSystemSettingsContent(),
                    'system-logs': this.getSystemLogsContent()
                };

                content.innerHTML = pages[page] || pages['dashboard'];
                this.currentPage = page;
            }

            // Deploy functionality
            showNewCodeModal() {
                const form = document.getElementById('codeForm');
                if (form) {
                    form.style.display = 'block';
                    document.getElementById('codeFilename').focus();
                }
            }

            hideCodeForm() {
                const form = document.getElementById('codeForm');
                if (form) {
                    form.style.display = 'none';
                    // Clear form
                    document.getElementById('codeFilename').value = '';
                    document.getElementById('codeContent').value = '';
                }
            }

            async deployCode() {
                const filename = document.getElementById('codeFilename').value.trim();
                const content = document.getElementById('codeContent').value.trim();
                const type = document.getElementById('codeType').value;

                if (!filename || !content) {
                    this.showResult('Por favor, preencha todos os campos.', 'error');
                    return;
                }

                this.showResult('Fazendo deploy...', 'loading');

                try {
                    const response = await fetch('/api/deploy-code.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            filename: filename,
                            content: content,
                            type: type,
                            codeId: Date.now(),
                            codeName: filename
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.showResult(`✅ Deploy realizado com sucesso!<br><strong>URL:</strong> <a href="${result.url}" target="_blank" style="color: var(--blue-500);">${result.url}</a>`, 'success');
                        this.hideCodeForm();
                    } else {
                        this.showResult(`❌ Erro no deploy: ${result.error || 'Erro desconhecido'}`, 'error');
                    }
                } catch (error) {
                    this.showResult(`❌ Erro de conexão: ${error.message}`, 'error');
                }
            }

            async testDeploy() {
                this.showResult('Testando API de deploy...', 'loading');

                const testCode = {
                    filename: 'dashboard-clean-test',
                    content: '/* Dashboard WidgetVPN Clean Test */\\n.dashboard-clean { background: #f8fafc; color: #1e293b; }\\n/* Professional, minimal, no emojis */',
                    type: 'css',
                    codeId: Date.now(),
                    codeName: 'Dashboard Clean Test'
                };

                try {
                    const response = await fetch('/api/deploy-code.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(testCode)
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.showResult(`✅ API funcionando!<br><strong>Teste deployado:</strong> <a href="${result.url}" target="_blank" style="color: var(--blue-500);">${result.filename}</a>`, 'success');
                    } else {
                        this.showResult(`❌ API erro: ${result.error || 'Erro desconhecido'}`, 'error');
                    }
                } catch (error) {
                    this.showResult(`❌ Erro de conexão: ${error.message}`, 'error');
                }
            }

            showResult(message, type) {
                const container = document.getElementById('deployResult');
                if (!container) return;

                const colors = {
                    success: 'var(--green-500)',
                    error: 'var(--red-500)',
                    loading: 'var(--blue-500)'
                };

                container.innerHTML = `
                    <div style="padding: 16px; border-left: 4px solid ${colors[type] || 'var(--gray-300)'}; background: var(--gray-50); border-radius: var(--border-radius);">
                        ${message}
                    </div>
                `;
            }

            getDashboardContent() {
                return `
                    <div class="card-grid">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">💻 Script Deploy</div>
                                    <div class="card-subtitle">Sistema de deployment de códigos CSS/JS</div>
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" style="color: var(--green-500);">Ativo</div>
                                <div class="metric-label">status</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="dash-total-codes">-</div>
                                <div class="metric-label">códigos deployados</div>
                            </div>
                            <a href="#" class="btn btn-primary" data-page="script-codes">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                                </svg>
                                Gerenciar Códigos
                            </a>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">📱 App Manager</div>
                                    <div class="card-subtitle">Gerenciamento de aplicações mobile</div>
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" style="color: var(--blue-400);">Em Desenvolvimento</div>
                                <div class="metric-label">status</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">Q1 2025</div>
                                <div class="metric-label">previsão</div>
                            </div>
                            <button class="btn btn-secondary" disabled>
                                Em Breve
                            </button>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">🔗 URL Shortener</div>
                                    <div class="card-subtitle">Encurtador de URLs personalizado</div>
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" style="color: var(--blue-400);">Em Desenvolvimento</div>
                                <div class="metric-label">status</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">Q1 2025</div>
                                <div class="metric-label">previsão</div>
                            </div>
                            <button class="btn btn-secondary" disabled>
                                Em Breve
                            </button>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">📊 Analytics Hub</div>
                                    <div class="card-subtitle">Central de análise e métricas</div>
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" style="color: var(--blue-400);">Em Desenvolvimento</div>
                                <div class="metric-label">status</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">Q2 2025</div>
                                <div class="metric-label">previsão</div>
                            </div>
                            <button class="btn btn-secondary" disabled>
                                Em Breve
                            </button>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <div>
                                <div class="card-title">🚀 Ações Rápidas</div>
                                <div class="card-subtitle">Tarefas mais comuns</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <a href="#" class="btn btn-primary" data-page="script-codes">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                                </svg>
                                Novo Código
                            </a>
                            <a href="#" class="btn btn-secondary" data-page="script-deploy">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                </svg>
                                Ver Deploys
                            </a>
                            <button class="btn btn-secondary" onclick="window.dashboard.testDeploy()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                Teste API
                            </button>
                        </div>
                    </div>
                `;
            }

            getScriptCodesContent() {
                // Load existing codes when page loads
                setTimeout(() => this.loadExistingCodes(), 100);

                return `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Gerenciar Códigos</div>
                                <div class="card-subtitle">CSS e JavaScript para deploy</div>
                            </div>
                        </div>
                        <div style="margin-bottom: 24px;">
                            <button class="btn btn-primary" onclick="window.dashboard.showNewCodeModal()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                                </svg>
                                Novo Código
                            </button>
                            <button class="btn btn-secondary" onclick="window.dashboard.testDeploy()" style="margin-left: 12px;">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                </svg>
                                Teste Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="window.dashboard.loadExistingCodes()" style="margin-left: 12px;">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                </svg>
                                Atualizar Lista
                            </button>
                        </div>
                        <div id="deployResult" style="margin-bottom: 24px;"></div>
                        <div class="code-form" style="display: none;" id="codeForm">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Nome do arquivo:</label>
                                <input type="text" id="codeFilename" placeholder="ex: meu-codigo-css" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: var(--border-radius);">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Tipo:</label>
                                <select id="codeType" style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: var(--border-radius);">
                                    <option value="css">CSS</option>
                                    <option value="js">JavaScript</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Código:</label>
                                <textarea id="codeContent" rows="10" placeholder="Seu código CSS ou JavaScript aqui..." style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: var(--border-radius); font-family: 'SF Mono', Consolas, monospace;"></textarea>
                            </div>
                            <div>
                                <button class="btn btn-primary" onclick="window.dashboard.deployCode()">Deploy</button>
                                <button class="btn btn-secondary" onclick="window.dashboard.hideCodeForm()" style="margin-left: 12px;">Cancelar</button>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de códigos existentes -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Códigos Existentes</div>
                                <div class="card-subtitle">Lista de códigos CSS e JS deployados</div>
                            </div>
                        </div>
                        <div id="existingCodesContainer">
                            <div style="text-align: center; padding: 40px; color: var(--gray-500);">
                                <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20" style="margin-bottom: 16px; opacity: 0.5;">
                                    <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                </svg>
                                <div>Carregando códigos...</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            async loadExistingCodes() {
                const container = document.getElementById('existingCodesContainer');
                if (!container) return;

                // Show loading
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray-500);">
                        <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20" style="margin-bottom: 16px; opacity: 0.5; animation: spin 1s linear infinite;">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                        </svg>
                        <div>Carregando códigos...</div>
                    </div>
                    <style>
                        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                    </style>
                `;

                try {
                    // Try local first, then fallback to GitHub Pages
                    let response;
                    try {
                        response = await fetch('/assets/index.json');
                        if (!response.ok) throw new Error('Local fetch failed');
                    } catch (e) {
                        console.log('Local fetch failed, trying GitHub Pages...');
                        response = await fetch('https://philling-dev.github.io/loja-integrada-assets/assets/index.json');
                    }

                    const data = await response.json();
                    const codes = Object.values(data);

                    if (codes.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--gray-500);">
                                <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20" style="margin-bottom: 16px; opacity: 0.5;">
                                    <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                </svg>
                                <div>Nenhum código encontrado</div>
                                <div style="margin-top: 8px; font-size: 14px;">Clique em "Novo Código" para criar o primeiro</div>
                            </div>
                        `;
                        return;
                    }

                    // Sort by deployed date (newest first)
                    codes.sort((a, b) => new Date(b.deployedAt) - new Date(a.deployedAt));

                    // Group by type
                    const cssFiles = codes.filter(code => code.type === 'css');
                    const jsFiles = codes.filter(code => code.type === 'js');

                    let html = '';

                    if (cssFiles.length > 0) {
                        html += `
                            <div style="margin-bottom: 32px;">
                                <h3 style="margin-bottom: 16px; color: var(--gray-700); font-size: 16px; font-weight: 600;">
                                    <span style="background: linear-gradient(135deg, #2563eb, #3b82f6); background-clip: text; -webkit-background-clip: text; color: transparent;">CSS Files (${cssFiles.length})</span>
                                </h3>
                                <div style="display: grid; gap: 12px;">
                                    ${cssFiles.map(code => this.renderCodeItem(code)).join('')}
                                </div>
                            </div>
                        `;
                    }

                    if (jsFiles.length > 0) {
                        html += `
                            <div style="margin-bottom: 16px;">
                                <h3 style="margin-bottom: 16px; color: var(--gray-700); font-size: 16px; font-weight: 600;">
                                    <span style="background: linear-gradient(135deg, #f59e0b, #f97316); background-clip: text; -webkit-background-clip: text; color: transparent;">JavaScript Files (${jsFiles.length})</span>
                                </h3>
                                <div style="display: grid; gap: 12px;">
                                    ${jsFiles.map(code => this.renderCodeItem(code)).join('')}
                                </div>
                            </div>
                        `;
                    }

                    container.innerHTML = html;

                } catch (error) {
                    console.error('Error loading codes:', error);
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--red-500);">
                            <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20" style="margin-bottom: 16px; opacity: 0.5;">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                            <div>Erro ao carregar códigos</div>
                            <div style="margin-top: 8px; font-size: 14px;">${error.message}</div>
                            <button class="btn btn-secondary" onclick="window.dashboard.loadExistingCodes()" style="margin-top: 16px;">
                                Tentar Novamente
                            </button>
                        </div>
                    `;
                }
            }

            renderCodeItem(code) {
                const deployedDate = new Date(code.deployedAt).toLocaleString('pt-BR');
                const sizeKB = (code.size / 1024).toFixed(1);
                const typeColor = code.type === 'css' ? '#3b82f6' : '#f97316';
                const sourceIcon = code.source === 'github_sync' ? '🔄' : '📝';
                const sourceText = code.source === 'github_sync' ? 'GitHub Sync' : 'Deploy Local';

                // Status de deploy
                const deployStatus = code.url && code.url.includes('github.io') ? 'deployed' : 'local';
                const statusIcon = deployStatus === 'deployed' ? '✅' : '⏳';
                const statusText = deployStatus === 'deployed' ? 'Deployed' : 'Local';
                const statusColor = deployStatus === 'deployed' ? '#10b981' : '#f59e0b';

                return `
                    <div data-code-id="${code.id}" style="border: 1px solid var(--gray-200); border-radius: var(--border-radius); padding: 16px; background: white; transition: all 0.2s ease; position: relative;"
                         onmouseenter="this.style.boxShadow='0 10px 25px rgba(0,0,0,0.1)'; this.style.transform='translateY(-2px)'"
                         onmouseleave="this.style.boxShadow='none'; this.style.transform='translateY(0)'">

                        <!-- Status Badge -->
                        <div style="position: absolute; top: 12px; right: 16px;">
                            <span style="background: ${statusColor}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">
                                ${statusIcon} ${statusText}
                            </span>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; padding-right: 80px;">
                            <div style="flex: 1; min-width: 0;">
                                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                                    <span style="background: ${typeColor}; color: white; padding: 3px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; margin-right: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        ${code.type.toUpperCase()}
                                    </span>
                                    <h4 style="margin: 0; font-size: 15px; font-weight: 600; color: var(--gray-900); line-height: 1.2;">
                                        ${code.name}
                                    </h4>
                                </div>
                                <div style="font-size: 13px; color: var(--gray-600); margin-bottom: 4px; display: flex; align-items: center;">
                                    📁 <span style="font-family: monospace; margin-left: 4px;">${code.filename}</span>
                                </div>
                                <div style="font-size: 12px; color: var(--gray-500); display: flex; align-items: center; gap: 12px;">
                                    <span>📅 ${deployedDate}</span>
                                    <span>📦 ${sizeKB}KB</span>
                                    <span>${sourceIcon} ${sourceText}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Actions Row -->
                        <div style="border-top: 1px solid var(--gray-100); padding-top: 12px; margin-top: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1; font-size: 11px; color: var(--gray-500); margin-right: 16px;">
                                    🔗 <span style="font-family: monospace; word-break: break-all;">${code.url}</span>
                                </div>
                                <div style="display: flex; gap: 6px; flex-shrink: 0;">
                                    <button onclick="window.dashboard.editCode('${code.id}')" class="btn-icon" title="Editar Código" style="background: #3b82f6; color: white; padding: 6px; border-radius: 6px; border: none; cursor: pointer;">
                                        <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                        </svg>
                                    </button>
                                    <button onclick="window.dashboard.redeployCode('${code.id}')" class="btn-icon" title="Re-deploy" style="background: #10b981; color: white; padding: 6px; border-radius: 6px; border: none; cursor: pointer;">
                                        <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                    <button onclick="window.dashboard.copyUrl('${code.url}')" class="btn-icon" title="Copiar URL" style="background: #6b7280; color: white; padding: 6px; border-radius: 6px; border: none; cursor: pointer;">
                                        <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                                        </svg>
                                    </button>
                                    <button onclick="window.open('${code.url}', '_blank')" class="btn-icon" title="Abrir URL" style="background: #6b7280; color: white; padding: 6px; border-radius: 6px; border: none; cursor: pointer;">
                                        <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M4.25 5.5a.75.75 0 00-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0112.75 17h-8.5A2.25 2.25 0 012 14.75v-8.5A2.25 2.25 0 014.25 4h5a.75.75 0 010 1.5h-5z"/>
                                            <path fill-rule="evenodd" d="M6.194 12.753a.75.75 0 001.06.053L16.5 4.44v2.81a.75.75 0 001.5 0v-4.5a.75.75 0 00-.75-.75h-4.5a.75.75 0 000 1.5h2.553l-9.056 8.194a.75.75 0 00-.053 1.06z"/>
                                        </svg>
                                    </button>
                                    <button onclick="window.dashboard.deleteCode('${code.id}')" class="btn-icon" title="Deletar" style="background: #ef4444; color: white; padding: 6px; border-radius: 6px; border: none; cursor: pointer;">
                                        <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            async editCode(codeId) {
                try {
                    // Fetch the code content from the deployed URL
                    const container = document.getElementById('existingCodesContainer');
                    const codeElement = container.querySelector(`[data-code-id="${codeId}"]`);

                    // Find the code in the data
                    const response = await fetch('/assets/index.json');
                    const data = await response.json();
                    const code = Object.values(data).find(c => c.id === codeId);

                    if (!code) {
                        this.showResult('Código não encontrado', 'error');
                        return;
                    }

                    // Fetch the actual code content
                    const codeResponse = await fetch(code.url);
                    const codeContent = await codeResponse.text();

                    // Pre-fill the form with the code data
                    document.getElementById('codeFilename').value = code.name;
                    document.getElementById('codeType').value = code.type;
                    document.getElementById('codeContent').value = codeContent;

                    // Show the form
                    this.showNewCodeModal();

                    // Add editing mode indicator
                    this.isEditing = codeId;
                    const deployBtn = document.querySelector('#codeForm .btn-primary');
                    if (deployBtn) {
                        deployBtn.textContent = 'Atualizar';
                    }

                    this.showResult('💫 Modo de edição ativado', 'info');
                } catch (error) {
                    console.error('Error editing code:', error);
                    this.showResult('Erro ao carregar código para edição', 'error');
                }
            }

            async redeployCode(codeId) {
                try {
                    // Find the code data
                    const response = await fetch('/assets/index.json');
                    const data = await response.json();
                    const code = Object.values(data).find(c => c.id === codeId);

                    if (!code) {
                        this.showResult('Código não encontrado', 'error');
                        return;
                    }

                    // Show loading state
                    this.showResult('🚀 Re-deployando código...', 'info');

                    // Fetch the current code content
                    const codeResponse = await fetch(code.url);
                    const codeContent = await codeResponse.text();

                    // Re-deploy using the existing content
                    const deployResponse = await fetch('/api/deploy-code.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            filename: code.name,
                            content: codeContent,
                            type: code.type,
                            codeId: code.id,
                            codeName: code.name
                        })
                    });

                    const result = await deployResponse.json();

                    if (result.success) {
                        this.showResult(`✅ ${code.name} re-deployado com sucesso!`, 'success');
                        // Refresh the list after a short delay
                        setTimeout(() => {
                            this.loadExistingCodes();
                        }, 1000);
                    } else {
                        this.showResult(`❌ Erro no re-deploy: ${result.error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error redeploying code:', error);
                    this.showResult('Erro no re-deploy', 'error');
                }
            }

            async deleteCode(codeId) {
                try {
                    // Find the code data
                    const response = await fetch('/assets/index.json');
                    const data = await response.json();
                    const code = Object.values(data).find(c => c.id === codeId);

                    if (!code) {
                        this.showResult('Código não encontrado', 'error');
                        return;
                    }

                    // Confirm deletion
                    const confirmed = confirm(`🗑️ Tem certeza que deseja deletar "${code.name}"?\n\nEsta ação não pode ser desfeita.`);
                    if (!confirmed) return;

                    this.showResult('🗑️ Deletando código...', 'info');

                    // Note: Since we can't actually delete from GitHub Pages directly,
                    // we'll need to implement a deletion API or mark as deleted
                    // For now, we'll show a message about the limitation
                    this.showResult(`⚠️ Funcionalidade de deleção em desenvolvimento.\n\nPara remover "${code.name}", você pode:\n1. Editar e substituir com código vazio\n2. Renomear para obsoleto_${code.name}`, 'warning');

                    // TODO: Implement actual deletion via GitHub API
                    // This would require GitHub token and proper deletion workflow

                } catch (error) {
                    console.error('Error deleting code:', error);
                    this.showResult('Erro ao deletar código', 'error');
                }
            }

            async copyUrl(url) {
                try {
                    await navigator.clipboard.writeText(url);
                    this.showResult('URL copiada para a área de transferência!', 'success');
                } catch (err) {
                    console.error('Failed to copy:', err);
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        this.showResult('URL copiada para a área de transferência!', 'success');
                    } catch (err) {
                        this.showResult('Erro ao copiar URL', 'error');
                    }
                    document.body.removeChild(textArea);
                }
            }

            getScriptDeployContent() {
                // Load deploy stats when page loads
                setTimeout(() => this.loadDeployStats(), 100);

                return `
                    <div class="card-grid">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Status do Sistema</div>
                                    <div class="card-subtitle">GitHub Pages Deploy</div>
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" style="color: var(--green-500);">Online</div>
                                <div class="metric-label">status</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value" id="totalAssets">-</div>
                                <div class="metric-label">assets deployados</div>
                            </div>
                            <button class="btn btn-primary" onclick="window.dashboard.refreshStats()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                </svg>
                                Atualizar
                            </button>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Deploy Rápido</div>
                                    <div class="card-subtitle">Testar sistema</div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="window.dashboard.testDeploy()">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                </svg>
                                Teste Deploy
                            </button>
                            <div id="deployResult" style="margin-top: 16px;"></div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Assets Recentes</div>
                                <div class="card-subtitle">Últimos deployments</div>
                            </div>
                        </div>
                        <div id="recentAssets" style="color: var(--gray-500); text-align: center; padding: 20px;">
                            Carregando...
                        </div>
                    </div>
                `;
            }

            async loadDeployStats() {
                try {
                    const response = await fetch('https://philling-dev.github.io/loja-integrada-assets/assets/index.json');
                    const data = await response.json();

                    // Update total count
                    const totalElement = document.getElementById('totalAssets');
                    if (totalElement) {
                        totalElement.textContent = data.assets?.length || 0;
                    }

                    // Show recent assets
                    const recentContainer = document.getElementById('recentAssets');
                    if (recentContainer && data.assets) {
                        const recent = data.assets.slice(-5).reverse();
                        if (recent.length > 0) {
                            recentContainer.innerHTML = recent.map(asset => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--gray-200);">
                                    <div>
                                        <div style="font-weight: 500;">${asset.filename}</div>
                                        <div style="font-size: 12px; color: var(--gray-500);">${new Date(asset.deployedAt).toLocaleString()}</div>
                                    </div>
                                    <a href="https://philling-dev.github.io/loja-integrada-assets/assets/${asset.filename}" target="_blank" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">
                                        Ver
                                    </a>
                                </div>
                            `).join('');
                        } else {
                            recentContainer.innerHTML = '<div style="color: var(--gray-500); text-align: center; padding: 20px;">Nenhum asset encontrado</div>';
                        }
                    }
                } catch (error) {
                    console.error('Erro ao carregar stats:', error);
                    const recentContainer = document.getElementById('recentAssets');
                    if (recentContainer) {
                        recentContainer.innerHTML = '<div style="color: var(--red-500); text-align: center; padding: 20px;">Erro ao carregar dados</div>';
                    }
                }
            }

            refreshStats() {
                this.loadDeployStats();
                this.showResult('✅ Dados atualizados', 'success');
            }

            getScriptSettingsContent() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Configurações do Script Deploy</div>
                                <div class="card-subtitle">Ajustes e preferências do sistema</div>
                            </div>
                        </div>
                        <div style="display: grid; gap: 24px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <label style="display: flex; align-items: center; gap: 12px; padding: 16px; border: 1px solid var(--gray-200); border-radius: var(--border-radius);">
                                    <input type="checkbox" checked style="width: 16px; height: 16px;">
                                    <div>
                                        <div style="font-weight: 500; font-size: 14px;">Minificação Automática</div>
                                        <div style="font-size: 12px; color: var(--gray-500);">Compactar códigos automaticamente</div>
                                    </div>
                                </label>
                                <label style="display: flex; align-items: center; gap: 12px; padding: 16px; border: 1px solid var(--gray-200); border-radius: var(--border-radius);">
                                    <input type="checkbox" checked style="width: 16px; height: 16px;">
                                    <div>
                                        <div style="font-weight: 500; font-size: 14px;">Git Auto-commit</div>
                                        <div style="font-size: 12px; color: var(--gray-500);">Commit automático no deploy</div>
                                    </div>
                                </label>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 12px; font-size: 16px; font-weight: 600;">GitHub Pages</h4>
                                <div style="background: var(--gray-50); padding: 16px; border-radius: var(--border-radius); font-family: monospace; font-size: 13px;">
                                    <div><strong>Repositório:</strong> philling-dev/loja-integrada-assets</div>
                                    <div><strong>Branch:</strong> main</div>
                                    <div><strong>URL Base:</strong> https://philling-dev.github.io/loja-integrada-assets/assets/</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getSystemSettingsContent() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Configurações do Sistema</div>
                                <div class="card-subtitle">Configurações globais do dashboard</div>
                            </div>
                        </div>
                        <div style="color: var(--gray-500); text-align: center; padding: 40px;">
                            <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20" style="margin-bottom: 16px; opacity: 0.5;">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                            </svg>
                            <div>Configurações do sistema em desenvolvimento</div>
                        </div>
                    </div>
                `;
            }

            getSystemLogsContent() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Logs do Sistema</div>
                                <div class="card-subtitle">Histórico de atividades e eventos</div>
                            </div>
                        </div>
                        <div style="color: var(--gray-500); text-align: center; padding: 40px;">
                            <svg width="48" height="48" fill="currentColor" viewBox="0 0 20 20" style="margin-bottom: 16px; opacity: 0.5;">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                            </svg>
                            <div>Sistema de logs em desenvolvimento</div>
                        </div>
                    </div>
                `;
            }
        }

        // Global functions
        function toggleProject(projectId) {
            if (window.dashboard) {
                window.dashboard.toggleProject(projectId);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new Dashboard();

            // Load dashboard stats
            setTimeout(() => {
                fetch('https://philling-dev.github.io/loja-integrada-assets/assets/index.json')
                    .then(response => response.json())
                    .then(data => {
                        const dashTotalCodes = document.getElementById('dash-total-codes');
                        if (dashTotalCodes) {
                            dashTotalCodes.textContent = data.assets?.length || 0;
                        }
                    })
                    .catch(() => {
                        // Silently fail
                    });
            }, 500);
        });
    </script>
</body>
</html>